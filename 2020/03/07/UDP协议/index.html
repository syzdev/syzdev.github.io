<!DOCTYPE html><html lang="zh-CN" color-mode="light"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content=""><meta name="author" content="syz"><meta name="description" content=""><title>UDP协议 | syzdev</title><link rel="apple-touch-icon" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><link rel="icon" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/color-scheme.css"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css"><link rel="stylesheet" href="/css/github-markdown.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/comments.css"><link rel="stylesheet" href="/css/figcaption/mac-block.css"><script defer type="text/javascript" src="/plugins/jquery.min.js"></script><link href="/plugins/jquery.fancybox.min.css" rel="stylesheet"><script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script><script src="/js/fancybox.js"></script><script>var html=document.documentElement;const colorMode=localStorage.getItem("color-mode");colorMode&&document.documentElement.setAttribute("color-mode",colorMode)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="app"><div class="header"><div class="avatar"><a href="/"><img src="/images/avatar.png" alt=""></a><div class="nickname"><a href="/">syzdev</a></div></div><div class="navbar"><ul><li class="nav-item" data-path="/"><a href="/">首页</a></li><li class="nav-item" data-path="/archives/"><a href="/archives/">归档</a></li><li class="nav-item" data-path="/tags/"><a href="/tags/">标签</a></li><li class="nav-item" data-path="/about/"><a href="/about/">关于</a></li></ul></div></div><script src="/js/activeNav.js"></script><div class="flex-container"><script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script async type="text/javascript" src="/plugins/clipboard.min.js"></script><script src="/js/codeCopy.js"></script><div class="container post-details" id="post-details"><div class="post-content"><div class="post-title">UDP协议</div><div class="post-attach"><span class="post-pubtime"><i class="iconfont icon-updatetime" title="更新时间"></i> 2020-03-07 14:56:03 </span><span class="post-tags"><i class="iconfont icon-tags" title="标签"></i> <span class="span--tag"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络"><b>#</b> 计算机网络</a></span></span></div><div class="markdown-body"><h1 id="1-概述"><a class="markdownIt-Anchor" href="#1-概述"></a> 1 概述</h1><p>用户数据报协议（UDP，User Datagram Protocol），UDP作为传输层的一个重要的协议，它的主要的功能是在IP 端到端的服务之上，增加了有限的两个功能：</p><ol><li>端口的复用和分用功能；</li><li>差错检测的功能。</li></ol><p>另外，虽然UDP协议只提供<strong>不可靠</strong>的交付，看起来似乎非常不完美，但是UDP协议在某些方面具有特殊的优点，比如我们在看在线视频的时候我们要求数据是最新的最快的，如果这个时候要求数据的准确性，那么会带来较大的延迟，就像我们在看直播球赛的时候，我们希望看到准备直播画面，而不是有延迟半分钟或一分钟的画面，另外一个典型的例子就是在网络管理过程中我们希望采集到网络的实时数据，这个时候网络管理会使用某种基于UDP协议的方式，采集到最新最快的数据，若是采集过来的数据有延迟，那么这个数据已经不是实时数据了，不能表示此时网络的状况了。所以在有些情况下，UDP协议简单快速的特点，比TCP协议更有优势。</p><h1 id="2-udp的主要特点"><a class="markdownIt-Anchor" href="#2-udp的主要特点"></a> 2 UDP的主要特点</h1><ol><li><strong>UDP 是无连接的</strong>：发送数据之前不需要建立连接，因此减少了开销和发送数据之前的时延，这个特点是UDP协议的首要特点，可以这么说，UDP其他的特点，都是或多或少源自于这个特点；</li><li><strong>UDP 使用尽最大努力交付</strong>：即不保证可靠交付，因此主机不需要维持复杂的连接状态表，发送端只需要把数据打包成UDP数据报，交给IP协议传输，中间经过了哪些路由器，最后有没有到达目的主机，数据有没有出错，需不需要重传，这些问题主机都不知道；</li><li><strong>UDP 是面向报文的</strong>：所谓报文就是应用层交下来的报文，应用层有各种各样的报文，比如HTTP报文，FTP报文等，根据不同的应用层协议封装成不同的报文，UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。UDP 一次交付一个完整的报文，在网络层，IP协议可能会进行拆分工作；</li></ol><blockquote><p><strong>应用程序必须选择合适大小的报文</strong>：</p><ul><li>若报文太长，UDP 把它交给 IP 层后，IP 层在传送时可能要进行分片，这会降低 IP 层的效率；</li><li>若报文太短，UDP 把它交给 IP 层后，会使 IP 数据报的首部的相对长度太大，这也降低了 IP 层的效率。</li></ul></blockquote><ol start="4"><li><strong>UDP 没有拥塞控制</strong>：因此网络出现的拥塞不会使源主机的发送速率降低。这对某些实时应用是很重要的。很适合多媒体通信的要求，也就是说使用UDP协议的发送端，完全不会感知当前网路的状态是拥塞还是通畅，UDP协议还是会发送出去；</li><li><strong>UDP 支持一对一、一对多、多对一和多对多的交互通信</strong>：这时目的主机不一定是单个主机，有可能是多个主机同时接收到发送端发送的UDP报文；</li><li><strong>UDP 的首部开销小</strong>：只有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">8</span></span></span></span> 个字节，比 TCP 的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>20</mn></mrow><annotation encoding="application/x-tex">20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord">0</span></span></span></span> 个字节的首部要短，这样也就意味着把数据组成UDP报文时所要做的工作更少，消耗资源小，发送速度也更快。</li></ol><h1 id="3-udp的首部格式"><a class="markdownIt-Anchor" href="#3-udp的首部格式"></a> 3 UDP的首部格式</h1><h2 id="31-传输关系"><a class="markdownIt-Anchor" href="#31-传输关系"></a> 3.1 传输关系</h2><p>UDP协议作为传输层的一个经典协议，它和上下层的传输关系如下：</p><ol><li>应用层会把应用层报文交付给运输层；</li><li>运输层的UDP协议，直接把上层交付下来的所有数据当作UDP数据报的数据部分，再加上UDP首部交付给下层IP层；</li><li>IP层把运输层交付下来的整个UDP数据报当作IP数据报的数据部分，再加上IP首部，继续交给下一层。</li></ol><p>上述过程如下图所示：<br><img src="https://img-blog.csdnimg.cn/20200307141819316.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200307142357399.png" alt="在这里插入图片描述"></p><h2 id="32-首部格式"><a class="markdownIt-Anchor" href="#32-首部格式"></a> 3.2 首部格式</h2><p>除去两个端口号字段，还有一个长度字段，它用来标明整个UDP报文的长度是多少，最后一个字段是校验和字段，它实现了对整个UDP报文的校验功能。<br><img src="https://img-blog.csdnimg.cn/2020030714273429.png" alt="在这里插入图片描述" style="zoom:67%"></p><h2 id="33-udp-基于端口的分用和复用"><a class="markdownIt-Anchor" href="#33-udp-基于端口的分用和复用"></a> 3.3 UDP 基于端口的分用和复用</h2><p>在UDP首部前两个字段当中，是源端口和目的端口，从接收端来讲，当接收端从 UDP报文中拆解出两个端口号之后，会根据端口号标识的内容，发送给上一层的应用程序，从而实现了端口的分用。</p><p>复用是分用的相反过程，应用程序把数据交付下来之后，其中的端口号就标明了这是哪一个应用进程。<br><img src="https://img-blog.csdnimg.cn/2020030714330598.png" alt="在这里插入图片描述"></p><h2 id="34-udp校验"><a class="markdownIt-Anchor" href="#34-udp校验"></a> 3.4 UDP校验</h2><p>在计算检验和时，临时把“<strong>伪首部</strong>”和 UDP 用户数据报连接在一起。伪首部仅仅是为了计算检验和：<br><img src="https://img-blog.csdnimg.cn/20200307143933688.png" alt="在这里插入图片描述" style="zoom:67%"></p><p>所谓伪首部，可以理解它就是一个“假的”首部，它并没有一个实际的地址空间，在进行 UDP 报文封装的时候并没有这部分内容，要不然UDP协议的首部是 $20 (8+12) $ 字节，而不是我们所说的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">8</span></span></span></span> 个字节，实际传输过程中，也并没有这样的字段。</p><p>设置这个伪首部，只是为了计算 校验和，这个伪首部包含的内容，如上图所示，这就有所疑问了，对于运输层来讲，本身没有IP地址这一概念，因为IP地址是在网络层中路由器转发所用的地址，为了计算校验和而强制引入的伪首部，包含IP地址信息，实际上会破坏网络分层，引入伪首部的目的，就是为了让 UDP 两次检查数据是不是正确的到达了目的地，其中一次是对UDP端口号和其他数据的校验，另一次是对IP地址的再校验，因为 IP 地址在路由器转发过程中，有可能会发现 IP 地址错误，所以 UDP 协议觉得 IP 地址校验是很有必要的。</p><p>如下就是校验的例子，简单来说就是把首部部分，每 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span></span></span></span> 个字节写成一行，然后按列排下来，每一列对应的每一位进行求和，得出来的结果再求反码，再将其放入校验和的位置中。<br><img src="https://img-blog.csdnimg.cn/20200307145415697.png" alt="在这里插入图片描述"></p></div><div class="prev-or-next"><div class="post-foot-next"><a href="/2020/03/06/OSPF%E5%8D%8F%E8%AE%AE/" target="_self"><i class="iconfont icon-chevronleft"></i> <span>上一页</span></a></div><div class="post-attach"><span class="post-pubtime"><i class="iconfont icon-updatetime" title="更新时间"></i> 2020-03-07 14:56:03 </span><span class="post-tags"><i class="iconfont icon-tags" title="标签"></i> <span class="span--tag"><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络"><b>#</b> 计算机网络</a></span></span></div><div class="post-foot-prev"><a href="/2020/03/07/TCP%E5%8D%8F%E8%AE%AE/" target="_self"><span>下一页</span> <i class="iconfont icon-chevronright"></i></a></div></div></div><div id="btn-catalog" class="btn-catalog"><i class="iconfont icon-catalog"></i></div><div class="post-catalog hidden" id="catalog"><div class="title">目录</div><div class="catalog-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-text">1 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-udp%E7%9A%84%E4%B8%BB%E8%A6%81%E7%89%B9%E7%82%B9"><span class="toc-text">2 UDP的主要特点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-udp%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-text">3 UDP的首部格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E4%BC%A0%E8%BE%93%E5%85%B3%E7%B3%BB"><span class="toc-text">3.1 传输关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-text">3.2 首部格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-udp-%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%88%86%E7%94%A8%E5%92%8C%E5%A4%8D%E7%94%A8"><span class="toc-text">3.3 UDP 基于端口的分用和复用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-udp%E6%A0%A1%E9%AA%8C"><span class="toc-text">3.4 UDP校验</span></a></li></ol></li></ol></div></div><script src="/js/catalog.js"></script><div class="comments-container"></div></div><div class="footer"><div class="social"><ul><li><a title="github" target="_blank" rel="noopener" href="https://github.com/syzdev"><i class="iconfont icon-github"></i></a></li></ul></div><div class="footer-more"><a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a></div></div></div><div class="tools-bar"><div class="back-to-top tools-bar-item hidden"><a href="javascript: void(0)"><i class="iconfont icon-chevronup"></i></a></div><script src="/js/backtotop.js"></script><div class="search-icon tools-bar-item" id="search-icon"><a href="javascript: void(0)"><i class="iconfont icon-search"></i></a></div><div class="search-overlay hidden"><div class="search-content" tabindex="0"><div class="search-title"><span class="search-icon-input"><a href="javascript: void(0)"><i class="iconfont icon-search"></i> </a></span><input type="text" class="search-input" id="search-input" placeholder="搜索..."> <span class="search-close-icon" id="search-close-icon"><a href="javascript: void(0)"><i class="iconfont icon-close"></i></a></span></div><div class="search-result" id="search-result"></div></div></div><script type="text/javascript">var inputArea=document.querySelector("#search-input"),searchOverlayArea=document.querySelector(".search-overlay");function openOrHideSearchContent(){searchOverlayArea.classList.contains("hidden")?(searchOverlayArea.classList.remove("hidden"),document.body.classList.add("hidden")):(searchOverlayArea.classList.add("hidden"),document.body.classList.remove("hidden"))}function blurSearchContent(e){e.target===searchOverlayArea&&openOrHideSearchContent()}inputArea.onclick=function(){getSearchFile(),this.onclick=null},inputArea.onkeydown=function(){if(13==event.keyCode)return!1},document.querySelector("#search-icon").addEventListener("click",openOrHideSearchContent,!1),document.querySelector("#search-close-icon").addEventListener("click",openOrHideSearchContent,!1),searchOverlayArea.addEventListener("click",blurSearchContent,!1);var searchFunc=function(e,t,n){"use strict";var r=document.getElementById(t),a=document.getElementById(n);a.innerHTML="<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get();a.innerHTML="",r.addEventListener("input",(function(){var e='<ul class="search-result-list">',n=this.value.trim().toLowerCase().split(/[\s\-]+/);if(a.innerHTML="",!(this.value.trim().length<=0)){if(t.forEach((function(t){var r=!0;t.title&&""!==t.title.trim()||(t.title="Untitled");var a=t.title.trim(),c=a.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),i=s.toLowerCase(),l=t.url,o=-1,u=-1,h=-1;if(""!==i?n.forEach((function(e,t){o=c.indexOf(e),u=i.indexOf(e),o<0&&u<0?r=!1:(u<0&&(u=0),0==t&&(h=u))})):r=!1,r){e+="<li><a href='"+l+"' class='search-result-title'>"+a+"</a>";var d=s;if(h>=0){var p=h-20,f=h+80;p<0&&(p=0),0==p&&(f=100),f>d.length&&(f=d.length);var m=d.substr(p,f);n.forEach((function(e){var t=new RegExp(e,"gi");m=m.replace(t,'<span class="search-keyword">'+e+"</span>")})),e+='<p class="search-result-abstract">'+m+"...</p>"}e+="</li>"}})),-1===(e+="</ul>").indexOf("<li>"))return a.innerHTML="<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";a.innerHTML=e}}))},error:function(e,t,n){a.innerHTML="",404===e.status?a.innerHTML="<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>":a.innerHTML="<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>"}}),$(document).on("click","#search-close-icon",(function(){$("#search-input").val(""),$("#search-result").html("")}))},getSearchFile=function(){searchFunc("/search.xml","search-input","search-result")}</script><div class="tools-bar-item theme-icon" id="switch-color-scheme"><a href="javascript: void(0)"><i id="theme-icon" class="iconfont icon-moon"></i></a></div><script src="/js/colorscheme.js"></script></div></div></body></html>