<!DOCTYPE html><html lang="zh-CN" color-mode="light"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content=""><meta name="author" content="syz"><meta name="description" content=""><title>AJAX基础 | syzdev</title><link rel="apple-touch-icon" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><link rel="icon" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/color-scheme.css"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css"><link rel="stylesheet" href="/css/github-markdown.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/comments.css"><link rel="stylesheet" href="/css/figcaption/mac-block.css"><script defer type="text/javascript" src="/plugins/jquery.min.js"></script><link href="/plugins/jquery.fancybox.min.css" rel="stylesheet"><script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script><script src="/js/fancybox.js"></script><script>var html=document.documentElement;const colorMode=localStorage.getItem("color-mode");colorMode&&document.documentElement.setAttribute("color-mode",colorMode)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="app"><div class="header"><div class="avatar"><a href="/"><img src="/images/avatar.png" alt=""></a><div class="nickname"><a href="/">syzdev</a></div></div><div class="navbar"><ul><li class="nav-item" data-path="/"><a href="/">首页</a></li><li class="nav-item" data-path="/archives/"><a href="/archives/">归档</a></li><li class="nav-item" data-path="/tags/"><a href="/tags/">标签</a></li><li class="nav-item" data-path="/about/"><a href="/about/">关于</a></li></ul></div></div><script src="/js/activeNav.js"></script><div class="flex-container"><script async type="text/javascript" src="/plugins/clipboard.min.js"></script><script src="/js/codeCopy.js"></script><div class="container post-details" id="post-details"><div class="post-content"><div class="post-title">AJAX基础</div><div class="post-attach"><span class="post-pubtime"><i class="iconfont icon-updatetime" title="更新时间"></i> 2021-08-26 21:46:09 </span><span class="post-tags"><i class="iconfont icon-tags" title="标签"></i> <span class="span--tag"><a href="/tags/%E5%89%8D%E7%AB%AF/" title="前端"><b>#</b> 前端</a></span></span></div><div class="markdown-body"><h1 id="1-ajax简介"><a class="markdownIt-Anchor" href="#1-ajax简介"></a> 1 AJAX简介</h1><p>Ajax = Asynchronous Javascript And XML，即异步JavaScript和XML，它最大的特点就是能够在网页不刷新的情况下向服务端发送HTTP请求，然后得到HTTP响应。AJAX不是新的编程语言，而是一种将现有的标准组合在一起使用的新方式。</p><h2 id="11-ajax的优点"><a class="markdownIt-Anchor" href="#11-ajax的优点"></a> 1.1 AJAX的优点</h2><ul><li>可以无需刷新页面与服务器进行交互</li><li>运行根据用户事件来更新部分页面内容</li></ul><h2 id="12-ajax的缺点"><a class="markdownIt-Anchor" href="#12-ajax的缺点"></a> 1.2 AJAX的缺点</h2><ul><li>没有浏览历史，不能回退</li><li>存在跨域问题</li><li>SEO问题</li></ul><h1 id="2-xml简介"><a class="markdownIt-Anchor" href="#2-xml简介"></a> 2 XML简介</h1><p>之所以在AJAX中提到XML是因为最初AJAX在进行数据交换的时候就是使用XML格式的数据（服务端给客户端返回的数据就是XML格式的，客户端再解析XML得到数据），XML 指可扩展标记语言（eXtensible Markup Language），XML 被设计用来传输和存储数据，如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以看到XML和HTML类似，不同的是HTML中都是预定义标签，而XML中没有预定义标签，全部都是自定义标签。<br>不过现在进行AJAX操作时，不再使用XML了，都是使用JSON格式了，这种数据格式更加灵活方便。</p><h1 id="3-json简介"><a class="markdownIt-Anchor" href="#3-json简介"></a> 3 JSON简介</h1><p>JSON = JavaScript Object Notation，即JavaScript 对象表示法，JSON 是存储和交换文本信息的语法，类似 XML。JSON 比 XML 更小、更快，更易解析，如：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;sites&quot;</span>: [</span><br><span class="line">      &#123; <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;百度&quot;</span> , <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;www.baidu.com&quot;</span> &#125;, </span><br><span class="line">      &#123; <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;谷歌&quot;</span> , <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;www.google.com&quot;</span> &#125;, </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-http协议请求报文与响应报文的格式"><a class="markdownIt-Anchor" href="#4-http协议请求报文与响应报文的格式"></a> 4 HTTP协议请求报文与响应报文的格式</h1><p>HTTP = HyperText Transfer Protocol，即超文本传输协议，协议详细规定了浏览器和万维网服务器之间互相通信的规则。</p><h2 id="41-请求报文"><a class="markdownIt-Anchor" href="#41-请求报文"></a> 4.1 请求报文</h2><p>一个HTTP请求报文由请求行（request line）、请求头部（header）、空行和请求数据4个部分组成，下图给出了请求报文的一般格式：<br><img src="https://img-blog.csdnimg.cn/876d38bed9064ebd812dd84d791900c9.png" alt=""></p><h2 id="42-响应报文"><a class="markdownIt-Anchor" href="#42-响应报文"></a> 4.2 响应报文</h2><p>HTTP响应报文由状态行、响应头部、空行 和 响应包体 4 个部分组成，如下图所示：<br><img src="https://img-blog.csdnimg.cn/a69f0a2501ee4804ab2dac440c3d1fa5.png" alt=""></p><h1 id="5-ajax请求的基本操作"><a class="markdownIt-Anchor" href="#5-ajax请求的基本操作"></a> 5 AJAX请求的基本操作</h1><p>新建文件夹，输入命令：<code>npm init --yes</code>，初始化项目，输入<code>npm i express</code>安装Express框架，新建<code>express.js</code>，添加如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.get(<span class="string">&#x27;/msg&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置响应头，允许跨域</span></span><br><span class="line">  response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  <span class="comment">// 设置响应体</span></span><br><span class="line">  response.send(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务已启动，监听3000端口&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>输入<code>node express.js</code>命令后即可启动服务（建议使用nodemon工具，输入命令<code>nodemon express.js</code>后可以实现热更新）。在页面中发送请求的代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>)</span><br><span class="line">  xhr.send()</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 服务端返回了所有结果</span></span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="comment">// 响应成功，状态码首位为2时，代表请求成功</span></span><br><span class="line">      <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="comment">// 1.响应行</span></span><br><span class="line">        <span class="built_in">console</span>.log(xhr.status)</span><br><span class="line">        <span class="comment">// 2.响应状态字符串</span></span><br><span class="line">        <span class="built_in">console</span>.log(xhr.statusText)</span><br><span class="line">        <span class="comment">// 3.所有响应头</span></span><br><span class="line">        <span class="built_in">console</span>.log(xhr.getAllResponseHeaders())</span><br><span class="line">        <span class="comment">// 4.响应体</span></span><br><span class="line">        <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台输出结果如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">200</span></span><br><span class="line">OK</span><br><span class="line">content-length: <span class="number">2</span></span><br><span class="line">content-type: text/html; charset=utf-<span class="number">8</span></span><br><span class="line">ok</span><br></pre></td></tr></table></figure><h1 id="6-ajax设置请求参数"><a class="markdownIt-Anchor" href="#6-ajax设置请求参数"></a> 6 AJAX设置请求参数</h1><p>请求参数的添加方法可以在请求URL后面跟上“<code>?</code>”，再接上等式，如“<code>?a=1</code>”，若需要添加多个参数，则使用“<code>&amp;</code>”分隔即可：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/msg?a=1&amp;b=2&#x27;</span>)</span><br></pre></td></tr></table></figure><p>发送请求后，可以在Chrome浏览器的开发者调试工具“Network”中选择该请求，在右侧的“Headers”中看到“Query String Parameters”：<br><img src="https://img-blog.csdnimg.cn/b8332a14b4f448f78b57c618274c3f74.png" alt=""></p><h1 id="7-ajax发送post请求"><a class="markdownIt-Anchor" href="#7-ajax发送post请求"></a> 7 AJAX发送POST请求</h1><p>在<code>express.js</code>中添加处理POST请求的路由：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  const express = require(&#x27;express&#x27;)</span><br><span class="line">  const app = express()</span><br><span class="line">  app.get(&#x27;/msg&#x27;, (request, response) =&gt; &#123;</span><br><span class="line">    // 设置响应头，运行跨域</span><br><span class="line">    response.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;)</span><br><span class="line">    // 设置响应体</span><br><span class="line">    response.send(&#x27;ok&#x27;)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="addition">+  app.post(&#x27;/msg&#x27;, (request, response) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+    response.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;)</span></span><br><span class="line"><span class="addition">+    response.send(&#x27;POST OK&#x27;)</span></span><br><span class="line"><span class="addition">+  &#125;)</span></span><br><span class="line">  app.listen(3000, () =&gt; &#123;</span><br><span class="line">    console.log(&#x27;服务已启动，监听3000端口&#x27;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>页面中发送请求的代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>)</span><br><span class="line">xhr.send()</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="comment">// 响应成功，状态码首位为2时，代表请求成功</span></span><br><span class="line">    <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送请求后输出：“POST OK”。另外，在发送POST请求时可以手动设置请求体，可以把请求体放在<code>xhr.send()</code>的参数中：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;POST&#x27;, &#x27;http://127.0.0.1:3000/msg&#x27;)</span><br><span class="line"><span class="addition">+      xhr.send(&#x27;a=1&amp;b=2&#x27;)</span></span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          // 响应成功，状态码首位为2时，代表请求成功</span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>发送POST请求后，可以在开发者调试工具中看到：<br><img src="https://img-blog.csdnimg.cn/42ca93f718714f7b87f5151f7d1abebc.png" alt=""></p><h1 id="8-ajax中设置请求头信息"><a class="markdownIt-Anchor" href="#8-ajax中设置请求头信息"></a> 8 AJAX中设置请求头信息</h1><p>设置请求头的方法为<code>setRequestHeader</code>，它必须在<code>open</code>后<code>send</code>前，如：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;POST&#x27;, &#x27;http://127.0.0.1:3000/msg&#x27;)</span><br><span class="line">      // 设置请求头信息</span><br><span class="line"><span class="addition">+      xhr.setRequestHeader(&#x27;Content-Type&#x27;, &#x27;application/x-www-form-urlencoded&#x27;)</span></span><br><span class="line">      xhr.send(&#x27;a=1&amp;b=2&#x27;)</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>此外还可以自定义请求头，如：<code>xhr.setRequestHeader('MyRequestHeader', 'test')</code>，不过设置这种请求头后发送请求会触发安全机制。</p><h1 id="9-服务端响应json数据"><a class="markdownIt-Anchor" href="#9-服务端响应json数据"></a> 9 服务端响应JSON数据</h1><p>在<code>express.js</code>中添加如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/json&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> jsonData = &#123;</span><br><span class="line">    name: <span class="string">&#x27;syz&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 对对象进行字符串转换</span></span><br><span class="line">  <span class="keyword">let</span> str = <span class="built_in">JSON</span>.stringify(jsonData)</span><br><span class="line">  <span class="comment">// send只能发送字符串</span></span><br><span class="line">  response.send(str)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>发送请求的代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/json&#x27;</span>)</span><br><span class="line">  xhr.send()</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：<code>&#123;&quot;name&quot;:&quot;syz&quot;&#125;</code>，注意这里只是字符串的形式，客户端要对该数据进行处理，则需要将字符串转换为对象：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;GET&#x27;, &#x27;http://127.0.0.1:3000/json&#x27;)</span><br><span class="line">      xhr.send()</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line"><span class="addition">+          	 // 字符串转换为对象</span></span><br><span class="line"><span class="addition">+            let data = JSON.parse(xhr.response)</span></span><br><span class="line"><span class="addition">+            console.log(data)</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这样输出的结果就为对象的形式。此外还有一种自动转换的方式，这种方式需要借助于<code>XMLHttpRequest</code>对象上的<code>respnseType</code>属性：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line"><span class="addition">+      // 将响应类型设置为json</span></span><br><span class="line"><span class="addition">+      xhr.responseType = &#x27;json&#x27;</span></span><br><span class="line">      xhr.open(&#x27;GET&#x27;, &#x27;http://127.0.0.1:3000/json&#x27;)</span><br><span class="line">      xhr.send()</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这样输出的结果也是对象的形式，这种方式更加的方便。</p><h1 id="10-ajax请求超时与异常处理"><a class="markdownIt-Anchor" href="#10-ajax请求超时与异常处理"></a> 10 AJAX请求超时与异常处理</h1><p>修改<code>express.js</code>中的<code>msg</code>接口，将其设置为4秒后再返回结果：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/msg&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    response.send(<span class="string">&#x27;POST OK&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">4000</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>页面中的访问方法如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  <span class="comment">// 超时设置，设置为2秒，若2秒后还没有得到结果，则请求取消</span></span><br><span class="line">  xhr.timeout = <span class="number">2000</span></span><br><span class="line">  xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>)</span><br><span class="line">  xhr.send()</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送请求后可以看到请求的状态在2秒后变为了<code>canceled</code>：<br><img src="https://img-blog.csdnimg.cn/2dfd32f769844a02982bbcc3e93cd08b.png" alt=""><br>还可以为超时设置回调函数，如：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line">      // 超时设置，设置为2秒，若2秒后还没有得到结果，则请求取消</span><br><span class="line">      xhr.timeout = 2000</span><br><span class="line"><span class="addition">+      // 超时回调</span></span><br><span class="line"><span class="addition">+      xhr.ontimeout = function() &#123;</span></span><br><span class="line"><span class="addition">+        console.log(&#x27;请求超时，请稍后再试！&#x27;)</span></span><br><span class="line"><span class="addition">+      &#125;</span></span><br><span class="line">      xhr.open(&#x27;POST&#x27;, &#x27;http://127.0.0.1:3000/msg&#x27;)</span><br><span class="line">      xhr.send()</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>还可以设置网络异常的回调，如没有网络：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    function send() &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest()</span><br><span class="line">      // 超时设置，设置为2秒，若2秒后还没有得到结果，则请求取消</span><br><span class="line">      xhr.timeout = 2000</span><br><span class="line">      // 超时回调</span><br><span class="line">      xhr.ontimeout = function() &#123;</span><br><span class="line">        console.log(&#x27;请求超时，请稍后再试！&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line"><span class="addition">+      // 异常回调</span></span><br><span class="line"><span class="addition">+      xhr.onerror = function() &#123;</span></span><br><span class="line"><span class="addition">+        console.log(&#x27;网络异常，请检查网络连接是否正确！&#x27;)</span></span><br><span class="line"><span class="addition">+      &#125;</span></span><br><span class="line">      xhr.open(&#x27;POST&#x27;, &#x27;http://127.0.0.1:3000/msg&#x27;)</span><br><span class="line">      xhr.send()</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="11-ajax取消请求"><a class="markdownIt-Anchor" href="#11-ajax取消请求"></a> 11 AJAX取消请求</h1><p>取消请求需要使用<code>XMLHttpRequest</code>上的<code>abort</code>方法：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+    let xhr = null</span></span><br><span class="line"></span><br><span class="line">    function send() &#123;</span><br><span class="line">      xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;POST&#x27;, &#x27;http://127.0.0.1:3000/msg&#x27;)</span><br><span class="line">      xhr.send()</span><br><span class="line">      xhr.onreadystatechange = function() &#123;</span><br><span class="line">        if (xhr.readyState <span class="comment">=== 4) &#123;</span></span><br><span class="line">          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;</span><br><span class="line">            console.log(xhr.response)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+    function cancelSend() &#123;</span></span><br><span class="line"><span class="addition">+      xhr.abort()</span></span><br><span class="line"><span class="addition">+    &#125;</span></span><br></pre></td></tr></table></figure><h1 id="12-ajax处理重复请求"><a class="markdownIt-Anchor" href="#12-ajax处理重复请求"></a> 12 AJAX处理重复请求</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="literal">null</span></span><br><span class="line"><span class="comment">// 标识变量，当前是否在发送AJAX请求</span></span><br><span class="line"><span class="keyword">let</span> isSending = <span class="literal">false</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 如果已经发送了，则取消上一次的请求，创建一个新的请求</span></span><br><span class="line">  <span class="keyword">if</span> (isSending) &#123;</span><br><span class="line">    xhr.abort()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在发送请求</span></span><br><span class="line">  isSending = <span class="literal">true</span></span><br><span class="line">  xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">  xhr.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>)</span><br><span class="line">  xhr.send()</span><br><span class="line">  xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">      <span class="comment">// 发送请求成功</span></span><br><span class="line">      isSending = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.response)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="13-jquery中发送ajax请求"><a class="markdownIt-Anchor" href="#13-jquery中发送ajax请求"></a> 13 JQuery中发送AJAX请求</h1><h2 id="131-发送get请求"><a class="markdownIt-Anchor" href="#131-发送get请求"></a> 13.1 发送GET请求</h2><p>第一个参数为请求的URL，第二个参数为请求参数，第二个参数为请求的回调。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>, &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>还可以传入第四个参数，第四个参数则是响应体类型，如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>, &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;, <span class="string">&#x27;json&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这里就将响应体的类型设置为了JSON格式。</p><h2 id="132-发送post请求"><a class="markdownIt-Anchor" href="#132-发送post请求"></a> 13.2 发送POST请求</h2><p>发送POST请求的方法与发送GET请求的方法类似：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.post(<span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>, &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="133-发送请求通用方法"><a class="markdownIt-Anchor" href="#133-发送请求通用方法"></a> 13.3 发送请求通用方法</h2><p>JQuery中发送请求的通用方法为<code>$</code>对象上的<code>ajax</code>方法，该方法接收的参数为一个对象：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  <span class="comment">// url</span></span><br><span class="line">  url: <span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>,</span><br><span class="line">  <span class="comment">// 参数</span></span><br><span class="line">  data: &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;,</span><br><span class="line">  <span class="comment">// 请求类型</span></span><br><span class="line">  type: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  <span class="comment">// 响应体结果的类型</span></span><br><span class="line">  dataType: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">  <span class="comment">// 成功的回调</span></span><br><span class="line">  success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 失败的回调 </span></span><br><span class="line">  error: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 超时时间</span></span><br><span class="line">  timeout: <span class="number">4000</span>,</span><br><span class="line">  <span class="comment">// 头信息</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="comment">// MyHeaders: 123</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="14-axios中发送ajax请求"><a class="markdownIt-Anchor" href="#14-axios中发送ajax请求"></a> 14 Axios中发送AJAX请求</h1><p>Axios是目前前端领域中最热门的AJAX工具库，也是Vue和React官方推荐的工具库。</p><h2 id="141-axios发送get请求"><a class="markdownIt-Anchor" href="#141-axios发送get请求"></a> 14.1 Axios发送GET请求</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.baseURL = <span class="string">&#x27;http://127.0.0.1:3000&#x27;</span></span><br><span class="line">axios.get(<span class="string">&#x27;/msg&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// url参数</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 设置请求头信息</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    MyHeaders: <span class="number">123</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 基于Promise</span></span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="142-axios发送post请求"><a class="markdownIt-Anchor" href="#142-axios发送post请求"></a> 14.2 Axios发送POST请求</h2><p>发送POST请求可以设置请求体信息，放在<code>post</code>方法的第二个参数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.baseURL = <span class="string">&#x27;http://127.0.0.1:3000&#x27;</span></span><br><span class="line">axios.post(<span class="string">&#x27;/msg&#x27;</span>, &#123;</span><br><span class="line">  username: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">  password: <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">// url参数</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 设置请求头信息</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    MyHeaders: <span class="number">123</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 基于Promise</span></span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="143-axios发送请求通用方法"><a class="markdownIt-Anchor" href="#143-axios发送请求通用方法"></a> 14.3 Axios发送请求通用方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.baseURL = <span class="string">&#x27;http://127.0.0.1:3000&#x27;</span></span><br><span class="line">axios(&#123;</span><br><span class="line">  <span class="comment">// 请求方法</span></span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="comment">// url</span></span><br><span class="line">  url: <span class="string">&#x27;/msg&#x27;</span>,</span><br><span class="line">  <span class="comment">// url参数</span></span><br><span class="line">  params: &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 头信息</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    MyHeaders: <span class="number">123</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 请求体参数</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    username: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="15-fetch方法发送ajax请求"><a class="markdownIt-Anchor" href="#15-fetch方法发送ajax请求"></a> 15 fetch方法发送AJAX请求</h1><p><code>fetch</code>方法全局自带，并且返回一个Promise对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;http://127.0.0.1:3000/msg&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 请求方法</span></span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="comment">// 请求头</span></span><br><span class="line">  headers: &#123;</span><br><span class="line">    MyHeaders: <span class="number">123</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 请求体</span></span><br><span class="line">  body: <span class="string">&#x27;username=admin&amp;password=123456&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 调用fetch中的text方法，再返回一个Promise对象</span></span><br><span class="line">  <span class="keyword">return</span> response.text()</span><br><span class="line">  <span class="comment">// 如果服务器返回的是json数据，可以使用json方法</span></span><br><span class="line">  <span class="comment">// return response.json()</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取到最终的响应数据</span></span><br><span class="line">  <span class="built_in">console</span>.log(response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div><div class="prev-or-next"><div class="post-foot-next"><a href="/2021/08/20/Promise%E8%87%AA%E5%AE%9A%E4%B9%89/" target="_self"><i class="iconfont icon-chevronleft"></i> <span>上一页</span></a></div><div class="post-attach"><span class="post-pubtime"><i class="iconfont icon-updatetime" title="更新时间"></i> 2021-08-26 21:46:09 </span><span class="post-tags"><i class="iconfont icon-tags" title="标签"></i> <span class="span--tag"><a href="/tags/%E5%89%8D%E7%AB%AF/" title="前端"><b>#</b> 前端</a></span></span></div><div class="post-foot-prev"><a href="/2022/03/15/%E6%B5%AE%E5%8A%A8%E5%92%8C%E6%B8%85%E9%99%A4%E6%B5%AE%E5%8A%A8/" target="_self"><span>下一页</span> <i class="iconfont icon-chevronright"></i></a></div></div></div><div id="btn-catalog" class="btn-catalog"><i class="iconfont icon-catalog"></i></div><div class="post-catalog hidden" id="catalog"><div class="title">目录</div><div class="catalog-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ajax%E7%AE%80%E4%BB%8B"><span class="toc-text">1 AJAX简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-ajax%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">1.1 AJAX的优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-ajax%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-text">1.2 AJAX的缺点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-xml%E7%AE%80%E4%BB%8B"><span class="toc-text">2 XML简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-json%E7%AE%80%E4%BB%8B"><span class="toc-text">3 JSON简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-http%E5%8D%8F%E8%AE%AE%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E4%B8%8E%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-text">4 HTTP协议请求报文与响应报文的格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87"><span class="toc-text">4.1 请求报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="toc-text">4.2 响应报文</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-ajax%E8%AF%B7%E6%B1%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">5 AJAX请求的基本操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-ajax%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">6 AJAX设置请求参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-ajax%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82"><span class="toc-text">7 AJAX发送POST请求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-ajax%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%BF%A1%E6%81%AF"><span class="toc-text">8 AJAX中设置请求头信息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%93%8D%E5%BA%94json%E6%95%B0%E6%8D%AE"><span class="toc-text">9 服务端响应JSON数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-ajax%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6%E4%B8%8E%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">10 AJAX请求超时与异常处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-ajax%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82"><span class="toc-text">11 AJAX取消请求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-ajax%E5%A4%84%E7%90%86%E9%87%8D%E5%A4%8D%E8%AF%B7%E6%B1%82"><span class="toc-text">12 AJAX处理重复请求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-jquery%E4%B8%AD%E5%8F%91%E9%80%81ajax%E8%AF%B7%E6%B1%82"><span class="toc-text">13 JQuery中发送AJAX请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#131-%E5%8F%91%E9%80%81get%E8%AF%B7%E6%B1%82"><span class="toc-text">13.1 发送GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#132-%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82"><span class="toc-text">13.2 发送POST请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#133-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">13.3 发送请求通用方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-axios%E4%B8%AD%E5%8F%91%E9%80%81ajax%E8%AF%B7%E6%B1%82"><span class="toc-text">14 Axios中发送AJAX请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#141-axios%E5%8F%91%E9%80%81get%E8%AF%B7%E6%B1%82"><span class="toc-text">14.1 Axios发送GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#142-axios%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82"><span class="toc-text">14.2 Axios发送POST请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#143-axios%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E9%80%9A%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">14.3 Axios发送请求通用方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-fetch%E6%96%B9%E6%B3%95%E5%8F%91%E9%80%81ajax%E8%AF%B7%E6%B1%82"><span class="toc-text">15 fetch方法发送AJAX请求</span></a></li></ol></div></div><script src="/js/catalog.js"></script><div class="comments-container"></div></div><div class="footer"><div class="social"><ul><li><a title="github" target="_blank" rel="noopener" href="https://github.com/syzdev"><i class="iconfont icon-github"></i></a></li></ul></div><div class="footer-more"><a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a></div></div></div><div class="tools-bar"><div class="back-to-top tools-bar-item hidden"><a href="javascript: void(0)"><i class="iconfont icon-chevronup"></i></a></div><script src="/js/backtotop.js"></script><div class="search-icon tools-bar-item" id="search-icon"><a href="javascript: void(0)"><i class="iconfont icon-search"></i></a></div><div class="search-overlay hidden"><div class="search-content" tabindex="0"><div class="search-title"><span class="search-icon-input"><a href="javascript: void(0)"><i class="iconfont icon-search"></i> </a></span><input type="text" class="search-input" id="search-input" placeholder="搜索..."> <span class="search-close-icon" id="search-close-icon"><a href="javascript: void(0)"><i class="iconfont icon-close"></i></a></span></div><div class="search-result" id="search-result"></div></div></div><script type="text/javascript">var inputArea=document.querySelector("#search-input"),searchOverlayArea=document.querySelector(".search-overlay");function openOrHideSearchContent(){searchOverlayArea.classList.contains("hidden")?(searchOverlayArea.classList.remove("hidden"),document.body.classList.add("hidden")):(searchOverlayArea.classList.add("hidden"),document.body.classList.remove("hidden"))}function blurSearchContent(e){e.target===searchOverlayArea&&openOrHideSearchContent()}inputArea.onclick=function(){getSearchFile(),this.onclick=null},inputArea.onkeydown=function(){if(13==event.keyCode)return!1},document.querySelector("#search-icon").addEventListener("click",openOrHideSearchContent,!1),document.querySelector("#search-close-icon").addEventListener("click",openOrHideSearchContent,!1),searchOverlayArea.addEventListener("click",blurSearchContent,!1);var searchFunc=function(e,t,n){"use strict";var r=document.getElementById(t),a=document.getElementById(n);a.innerHTML="<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map((function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}})).get();a.innerHTML="",r.addEventListener("input",(function(){var e='<ul class="search-result-list">',n=this.value.trim().toLowerCase().split(/[\s\-]+/);if(a.innerHTML="",!(this.value.trim().length<=0)){if(t.forEach((function(t){var r=!0;t.title&&""!==t.title.trim()||(t.title="Untitled");var a=t.title.trim(),c=a.toLowerCase(),s=t.content.trim().replace(/<[^>]+>/g,""),i=s.toLowerCase(),l=t.url,o=-1,u=-1,h=-1;if(""!==i?n.forEach((function(e,t){o=c.indexOf(e),u=i.indexOf(e),o<0&&u<0?r=!1:(u<0&&(u=0),0==t&&(h=u))})):r=!1,r){e+="<li><a href='"+l+"' class='search-result-title'>"+a+"</a>";var d=s;if(h>=0){var p=h-20,f=h+80;p<0&&(p=0),0==p&&(f=100),f>d.length&&(f=d.length);var m=d.substr(p,f);n.forEach((function(e){var t=new RegExp(e,"gi");m=m.replace(t,'<span class="search-keyword">'+e+"</span>")})),e+='<p class="search-result-abstract">'+m+"...</p>"}e+="</li>"}})),-1===(e+="</ul>").indexOf("<li>"))return a.innerHTML="<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";a.innerHTML=e}}))},error:function(e,t,n){a.innerHTML="",404===e.status?a.innerHTML="<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>":a.innerHTML="<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>"}}),$(document).on("click","#search-close-icon",(function(){$("#search-input").val(""),$("#search-result").html("")}))},getSearchFile=function(){searchFunc("/search.xml","search-input","search-result")}</script><div class="tools-bar-item theme-icon" id="switch-color-scheme"><a href="javascript: void(0)"><i id="theme-icon" class="iconfont icon-moon"></i></a></div><script src="/js/colorscheme.js"></script></div></div></body></html>