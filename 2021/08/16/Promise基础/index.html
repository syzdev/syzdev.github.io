<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;light&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><link rel="icon" href="https://cdn.u1.huluxia.com/g3/M03/4D/84/wKgBOV6fGZWATbp6AAAML1Rr8NY150.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="syz"><meta name="keywords" content=""><title>PromiseåŸºç¡€ - syzdev</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"yoursite.com",root:"/",version:"1.8.10",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:1},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:35vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>ğŸ˜„ syzdev</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://cdn.u1.huluxia.com/g3/M02/4D/6C/wKgBOV6fEU2AXFGSAAJ7A1Fp7rw147.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="PromiseåŸºç¡€"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-08-16 16:24" pubdate>2021å¹´8æœˆ16æ—¥ ä¸‹åˆ</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.9k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 54 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">PromiseåŸºç¡€</h1><div class="markdown-body"><h1 id="1-promiseä»‹ç»ä¸åŸºæœ¬ä½¿ç”¨"><a class="markdownIt-Anchor" href="#1-promiseä»‹ç»ä¸åŸºæœ¬ä½¿ç”¨"></a> 1 Promiseä»‹ç»ä¸åŸºæœ¬ä½¿ç”¨</h1><h2 id="11-ä»€ä¹ˆæ˜¯promise"><a class="markdownIt-Anchor" href="#11-ä»€ä¹ˆæ˜¯promise"></a> 1.1 ä»€ä¹ˆæ˜¯Promise</h2><p>Promiseæ˜¯ä¸€é—¨æ–°çš„æŠ€æœ¯ï¼Œè¯ç”ŸäºES6è§„èŒƒï¼ŒPromiseæ˜¯JSä¸­è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹çš„æ–°è§£å†³æ–¹æ¡ˆï¼ˆæ‰€è°“æ—§çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°è§£å†³å¼‚æ­¥é—®é¢˜ï¼‰ã€‚ä»è¯­æ³•çš„è§’åº¦æ¥çœ‹ï¼ŒPromiseæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»åŠŸèƒ½çš„è§’åº¦æ¥çœ‹ï¼ŒPromiseå¯¹è±¡ç”¨æ¥å°è£…ä¸€ä¸ªå¼‚æ­¥æ“ä½œå¹¶å¯ä»¥è·å–éƒ½æ“ä½œæ‰§è¡Œçš„ç»“æœå€¼ï¼Œå³æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥ã€‚</p><h2 id="12-ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹"><a class="markdownIt-Anchor" href="#12-ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹"></a> 1.2 ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹</h2><p>å¸¸è§çš„å¼‚æ­¥ç¼–ç¨‹åœºæ™¯æœ‰ï¼š</p><ol><li>fsæ–‡ä»¶æ“ä½œï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).readFile(<span class="hljs-string">&#x27;./index.html&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;)<br></code></pre></div></td></tr></table></figure><ol start="2"><li>æ•°æ®åº“æ“ä½œï¼šä¸æ–‡ä»¶æ“ä½œç±»ä¼¼ï¼›</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// å‡è®¾Courseä¸ºMongoDBä¸­å·²åˆ›å»ºçš„é›†åˆ</span><br>Course.find().then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(result))<br></code></pre></div></td></tr></table></figure><ol start="3"><li>AJAXç½‘ç»œè¯·æ±‚ï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// JQueryä¸­çš„getè¯·æ±‚</span><br>$.get(<span class="hljs-string">&#x27;/server&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;)<br></code></pre></div></td></tr></table></figure><ol start="4"><li>å®šæ—¶å™¨ï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;, <span class="hljs-number">1000</span>)<br></code></pre></div></td></tr></table></figure><h2 id="13-ä¸ºä»€ä¹ˆè¦ç”¨promise"><a class="markdownIt-Anchor" href="#13-ä¸ºä»€ä¹ˆè¦ç”¨promise"></a> 1.3 ä¸ºä»€ä¹ˆè¦ç”¨Promise</h2><h3 id="131-æ”¯æŒé“¾å¼è°ƒç”¨è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜"><a class="markdownIt-Anchor" href="#131-æ”¯æŒé“¾å¼è°ƒç”¨è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜"></a> 1.3.1 æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œè§£å†³å›è°ƒåœ°ç‹±é—®é¢˜</h3><p>æ‰€è°“å›è°ƒåœ°åŸŸæŒ‡çš„æ˜¯å›è°ƒå‡½æ•°ä¸­åˆåŒ…å«äº†ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">fs.readFile(<span class="hljs-string">&#x27;1.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>    fs.readFile(<span class="hljs-string">&#x27;2.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>        fs.readFile(<span class="hljs-string">&#x27;3.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>            fs.readFile(<span class="hljs-string">&#x27;4.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>							<span class="hljs-comment">// ...</span><br>            &#125;);<br>        &#125;);<br>    &#125;);<br>&#125;);<br></code></pre></div></td></tr></table></figure><p>æ˜¾ç„¶è¿™ç§ä»£ç çš„å¯è¯»æ€§éå¸¸å·®ï¼Œç”±äºä»£ç é€»è¾‘åµŒå¥—çš„éå¸¸ç´§ï¼Œä¹Ÿä¸ä¾¿äºåšå¼‚å¸¸å¤„ç†ã€‚</p><h3 id="132-æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»"><a class="markdownIt-Anchor" href="#132-æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»"></a> 1.3.2 æŒ‡å®šå›è°ƒå‡½æ•°çš„æ–¹å¼æ›´åŠ çµæ´»</h3><p>åœ¨æ—§çš„æ–¹æ¡ˆä¸­ï¼Œå›è°ƒå‡½æ•°æ¯æ¬¡éƒ½è¦åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œä¹‹å‰å‡†å¤‡å¥½ï¼Œä½¿ç”¨Promiseçš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å›çš„æ˜¯Promiseå¯¹è±¡ï¼Œä¹‹åç»™Promiseå¯¹è±¡ç»‘å®šå›è°ƒå‡½æ•°ï¼ˆç”šè‡³å¯ä»¥åœ¨å¼‚æ­¥ä»»åŠ¡ç»“æŸåç»‘å®šä¸€ä¸ªæˆ–å¤šä¸ªå›è°ƒå‡½æ•°ï¼‰ã€‚</p><h2 id="13-promiseçš„åŸºæœ¬ä½¿ç”¨"><a class="markdownIt-Anchor" href="#13-promiseçš„åŸºæœ¬ä½¿ç”¨"></a> 1.3 Promiseçš„åŸºæœ¬ä½¿ç”¨</h2><h3 id="131-å®šæ—¶å™¨æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#131-å®šæ—¶å™¨æ¡ˆä¾‹"></a> 1.3.1 å®šæ—¶å™¨æ¡ˆä¾‹</h3><p>ä»¥å®šæ—¶å™¨ä¸ºä¾‹ï¼Œè¯¥ç¨‹åºä¼šç”Ÿæˆä¸€ä¸ª0æˆ–1çš„éšæœºæ•°å¹¶è¾“å‡ºä¸åŒçš„ç»“æœï¼Œä¸‹é¢æ˜¯å¸¸è§„å›è°ƒçš„å®ç°æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ª0æˆ–1çš„éšæœºæ•°</span><br>  <span class="hljs-keyword">let</span> n = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random())<br>  <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;éšæœºæ•°å–åˆ°äº†0&#x27;</span>)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;éšæœºæ•°å–åˆ°äº†1&#x27;</span>)<br>  &#125;<br>&#125;, <span class="hljs-number">2000</span>)<br></code></pre></div></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä½¿ç”¨Promiseçš„å®ç°æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// resolveå’Œrejectéƒ½ä¸ºå‡½æ•°ç±»å‹çš„å‚æ•°</span><br><span class="hljs-comment">// pæ˜¯Promiseçš„å®ä¾‹å¯¹è±¡</span><br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> n = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random())<br>    <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-comment">// æ‰§è¡ŒæˆåŠŸçš„æ—¶å€™è°ƒç”¨resolveï¼Œå¹¶å°†Promiseå¯¹è±¡pçš„çŠ¶æ€è®¾ç½®ä¸ºæˆåŠŸ</span><br>      resolve()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// æ‰§è¡ŒæˆåŠŸçš„æ—¶å€™è°ƒç”¨rejectï¼Œå¹¶å°†Promiseå¯¹è±¡pçš„çŠ¶æ€è®¾ç½®ä¸ºå¤±è´¥</span><br>      reject()<br>    &#125;<br>  &#125;, <span class="hljs-number">2000</span>)<br>&#125;)<br><br><span class="hljs-comment">// Promiseçš„å®ä¾‹pè°ƒç”¨çš„thenæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°</span><br><span class="hljs-comment">// ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡ŒæˆåŠŸæ—¶çš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œå¤±è´¥æ—¶çš„å›è°ƒ</span><br>p.then(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;éšæœºæ•°å–åˆ°äº†0&#x27;</span>)<br>&#125;, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;éšæœºæ•°å–åˆ°äº†1&#x27;</span>)<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>æ­¤å¤–ï¼Œ<code>resolve</code>å’Œ<code>reject</code>æ–¹æ³•è¿˜èƒ½è·å–åˆ°å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœå€¼ï¼Œæ¯”å¦‚è¦æŠŠéšæœºæ•°è¾“å‡ºä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¦æŠŠéšæœºæ•°<code>n</code>ä¼ ç»™<code>resolve</code>å’Œ<code>reject</code>æ–¹æ³•ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff">  const p = new Promise((resolve, reject) =&gt; &#123;<br>    setTimeout(() =&gt; &#123;<br>      let n = Math.round(Math.random())<br>      if (n <span class="hljs-comment">=== 0) &#123;</span><br><span class="hljs-addition">+        resolve(n)</span><br>      &#125; else &#123;<br><span class="hljs-addition">+        reject(n)</span><br>      &#125;<br>    &#125;, 2000)<br>  &#125;)<br><br><span class="hljs-addition">+  p.then((value) =&gt; &#123;</span><br><span class="hljs-addition">+    console.log(`éšæœºæ•°å–åˆ°äº†$&#123;value&#125;`)</span><br><span class="hljs-addition">+  &#125;, (reason) =&gt; &#123;</span><br><span class="hljs-addition">+    console.log(`éšæœºæ•°å–åˆ°äº†$&#123;reason&#125;`)</span><br><span class="hljs-addition">+  &#125;)</span><br></code></pre></div></td></tr></table></figure><h3 id="132-fsè¯»å–æ–‡ä»¶æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#132-fsè¯»å–æ–‡ä»¶æ¡ˆä¾‹"></a> 1.3.2 fsè¯»å–æ–‡ä»¶æ¡ˆä¾‹</h3><blockquote><p>æ³¨æ„ï¼šè¯¥æ¡ˆä¾‹éœ€è¦å®‰è£…Nodeç¯å¢ƒã€‚</p></blockquote><p>ä¸‹é¢æ˜¯å¸¸è§„è¯»å–æ–‡ä»¶æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br>fs.readFile(<span class="hljs-string">&#x27;./test.txt&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// å¦‚æœå‡ºé”™åˆ™æŠ›å‡ºé”™è¯¯</span><br>  <span class="hljs-keyword">if</span> (err) &#123;<br>    <span class="hljs-keyword">throw</span> err<br>  &#125;<br>  <span class="hljs-comment">// å¦‚æœæ²¡æœ‰é”™è¯¯å°±è¾“å…¥æ–‡ä»¶å†…å®¹</span><br>  <span class="hljs-built_in">console</span>.log(res.toString())<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>è¾“å…¥nodeå‘½ä»¤æ‰§è¡Œjsæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°test.txtä¸­çš„å†…å®¹ã€‚<br>ä¸‹é¢æ˜¯Promiseçš„å®ç°æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">reslove, reject</span>) =&gt;</span> &#123;<br>  fs.readFile(<span class="hljs-string">&#x27;./test.txt&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-comment">// è¯»å–æˆåŠŸ</span><br>      reject(err)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// è¯»å–å¤±è´¥</span><br>      reslove(res)<br>    &#125;<br>  &#125;)<br>&#125;)<br><br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value.toString())<br>&#125;, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason.toString())<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="133-ajaxè¯·æ±‚æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#133-ajaxè¯·æ±‚æ¡ˆä¾‹"></a> 1.3.3 AJAXè¯·æ±‚æ¡ˆä¾‹</h3><p>å¸¸è§„å›è°ƒå½¢å¼ï¼š</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btn&quot;</span>&gt;</span>ç‚¹å‡»å‘é€AJAX<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="javascript">  <span class="hljs-keyword">const</span> btn = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;#btn&#x27;</span>)</span><br><span class="javascript">  btn.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="javascript">    <span class="hljs-comment">// 1.åˆ›å»ºå¯¹è±¡</span></span><br><span class="javascript">    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()</span><br><span class="javascript">    <span class="hljs-comment">// 2.åˆå§‹åŒ–</span></span><br><span class="javascript">    xhr.open(<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;https://api.apiopen.top/getJoke&#x27;</span>)</span><br><span class="javascript">    <span class="hljs-comment">// 3.å‘é€</span></span><br>    xhr.send()<br><span class="javascript">    <span class="hljs-comment">// 4.å¤„ç†å“åº”ç»“æœ</span></span><br><span class="javascript">    xhr.onreadystatechange = <span class="hljs-function">() =&gt;</span> &#123;</span><br>      if (xhr.readyState === 4) &#123;<br><span class="javascript">        <span class="hljs-comment">// åˆ¤æ–­å“åº”çŠ¶æ€ç </span></span><br>        if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;<br><span class="javascript">          <span class="hljs-comment">// å“åº”æˆåŠŸè¾“å…¥å“åº”å†…å®¹</span></span><br><span class="javascript">          <span class="hljs-built_in">console</span>.log(xhr.response)</span><br><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="javascript">          <span class="hljs-comment">// å“åº”å¤±è´¥è¾“å…¥å¤±è´¥çŠ¶æ€ç </span></span><br><span class="javascript">          <span class="hljs-built_in">console</span>.log(xhr.status)</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;)<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>ä¸‹é¢æ˜¯Promiseçš„å®ç°æ–¹æ³•ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs diff">  &lt;div&gt;<br>    &lt;button id=&quot;btn&quot;&gt;ç‚¹å‡»å‘é€AJAX&lt;/button&gt;<br>  &lt;/div&gt;<br>  &lt;script&gt;<br>    const btn = document.querySelector(&#x27;#btn&#x27;)<br>    btn.addEventListener(&#x27;click&#x27;, () =&gt; &#123;<br><span class="hljs-addition">+      // åˆ›å»ºPromiseå®ä¾‹</span><br><span class="hljs-addition">+      const p = new Promise((resolve, reject) =&gt; &#123;</span><br>        // 1.åˆ›å»ºå¯¹è±¡<br>        const xhr = new XMLHttpRequest()<br>        // 2.åˆå§‹åŒ–<br>        xhr.open(&#x27;GET&#x27;, &#x27;https://api.apiopen.top/getJoke&#x27;)<br>        // 3.å‘é€<br>        xhr.send()<br>        // 4.å¤„ç†å“åº”ç»“æœ<br>        xhr.onreadystatechange = () =&gt; &#123;<br>          if (xhr.readyState <span class="hljs-comment">=== 4) &#123;</span><br>            if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) &#123;<br><span class="hljs-addition">+              resolve(xhr.response)</span><br>            &#125; else &#123;<br><span class="hljs-addition">+              reject(xhr.status)</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;)<br><span class="hljs-addition">+      p.then(value =&gt; &#123;</span><br><span class="hljs-addition">+        console.log(value)</span><br><span class="hljs-addition">+      &#125;, reason =&gt; &#123;</span><br><span class="hljs-addition">+        console.log(reason)</span><br>      &#125;)<br><span class="hljs-addition">+    &#125;)</span><br>  &lt;/script&gt;<br></code></pre></div></td></tr></table></figure><h3 id="134-å°è£…è¯»å–æ–‡ä»¶æ“ä½œ"><a class="markdownIt-Anchor" href="#134-å°è£…è¯»å–æ–‡ä»¶æ“ä½œ"></a> 1.3.4 å°è£…è¯»å–æ–‡ä»¶æ“ä½œ</h3><blockquote><p>æ³¨æ„ï¼šåªèƒ½åœ¨nodeç¯å¢ƒä¸‹è¿è¡Œã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyReadFile</span>(<span class="hljs-params">path</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// è¯»å–æ–‡ä»¶</span><br>    <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>).readFile(path, <span class="hljs-function">(<span class="hljs-params">err, res</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        reject(err)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        resolve(res)<br>      &#125;<br>    &#125;)<br>  &#125;)<br>&#125;<br><br>MyReadFile(<span class="hljs-string">&#x27;../2-fsè¯»å–æ–‡ä»¶/test.txt&#x27;</span>).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value.toString())<br>&#125;, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason.toString())<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="135-promisifyæ–¹æ³•"><a class="markdownIt-Anchor" href="#135-promisifyæ–¹æ³•"></a> 1.3.5 promisifyæ–¹æ³•</h3><p><code>util.promisify</code>æ–¹æ³•å¯ä»¥å°†åŸæœ¬å›è°ƒå‡½æ•°çš„æ–¹æ³•å°è£…æˆPromiseçš„å½¢å¼ï¼Œå¦‚è¯»å–æ–‡ä»¶æ¡ˆä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>)<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-comment">// è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°</span><br><span class="hljs-keyword">let</span> MyReadFile = util.promisify(fs.readFile)<br>MyReadFile(<span class="hljs-string">&#x27;../2-fsè¯»å–æ–‡ä»¶/test.txt&#x27;</span>).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value.toString())<br>&#125;, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason)<br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="136-å°è£…ajaxè¯·æ±‚"><a class="markdownIt-Anchor" href="#136-å°è£…ajaxè¯·æ±‚"></a> 1.3.6 å°è£…AJAXè¯·æ±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendAJAX</span>(<span class="hljs-params">url</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()<br>    xhr.responseType = <span class="hljs-string">&#x27;json&#x27;</span><br>    xhr.open(<span class="hljs-string">&#x27;GET&#x27;</span>, url)<br>    xhr.send()<br>    xhr.onreadystatechange = <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (xhr.readyState === <span class="hljs-number">4</span>) &#123;<br>        <span class="hljs-keyword">if</span> (xhr.status &gt;= <span class="hljs-number">200</span> &amp;&amp; xhr.status &lt; <span class="hljs-number">300</span>) &#123;<br>          resolve(xhr.response)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          reject(xhr.status)<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;)<br>&#125;<br><br>sendAJAX(<span class="hljs-string">&#x27;https://api.apiopen.top/getJoke&#x27;</span>).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value)<br>&#125;, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason)<br>&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="14-promiseå¯¹è±¡çš„çŠ¶æ€"><a class="markdownIt-Anchor" href="#14-promiseå¯¹è±¡çš„çŠ¶æ€"></a> 1.4 Promiseå¯¹è±¡çš„çŠ¶æ€</h2><p>Promiseçš„çŠ¶æ€æ˜¯Promiseå®ä¾‹å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œè‹¥æŠŠä¸€ä¸ªPromiseå®ä¾‹è¾“å‡ºåœ¨æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>[[PromiseState]]</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§çš„å€¼æœ‰ä¸‰ç§å¯èƒ½ï¼š</p><ul><li><code>pending</code>ï¼šæœªå†³å®šçš„ï¼›</li><li><code>resolved</code> / <code>fullfilled</code>ï¼šæˆåŠŸï¼›</li><li><code>rejected</code>ï¼šå¤±è´¥ã€‚</li></ul><p>çŠ¶æ€çš„å˜æ¢åªæœ‰å¦‚ä¸‹ä¸¤ç§å¯èƒ½ï¼š</p><ul><li><code>pending</code> -&gt; <code>resolved</code>ï¼›</li><li><code>pending</code> -&gt; <code>rejected</code>ã€‚</li></ul><p>å¹¶ä¸”Promiseå¯¹è±¡å®ä¾‹çš„çŠ¶æ€åªèƒ½æ”¹å˜ä¸€æ¬¡ï¼Œæ— è®ºçŠ¶æ€æ”¹å˜æˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç»“æœå€¼ï¼Œä¸€èˆ¬æƒ…å†µè¯­ä¹‰åŒ–æŠŠæˆåŠŸçš„ç»“æœå€¼ç§°ä¸º<code>value</code>ï¼ŒæŠŠå¤±è´¥çš„ç»“æœå€¼ç§°ä¸º<code>reason</code>ã€‚</p><h2 id="15-promiseå¯¹è±¡çš„å€¼"><a class="markdownIt-Anchor" href="#15-promiseå¯¹è±¡çš„å€¼"></a> 1.5 Promiseå¯¹è±¡çš„å€¼</h2><p>Promiseå®ä¾‹å¯¹è±¡çš„å¦ä¸€ä¸ªçš„å±æ€§<code>[[PromiseResult]]</code>ï¼Œä¿å­˜çš„æ˜¯å¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥çš„ç»“æœï¼Œåªæœ‰<code>resolve</code>å’Œ<code>reject</code>æ–¹æ³•æ‰èƒ½å¯¹è¯¥å€¼è¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="16-promiseçš„åŸºæœ¬æµç¨‹"><a class="markdownIt-Anchor" href="#16-promiseçš„åŸºæœ¬æµç¨‹"></a> 1.6 Promiseçš„åŸºæœ¬æµç¨‹</h2><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg2020.cnblogs.com%2Fblog%2F1569466%2F202006%2F1569466-20200626141453221-1427511031.png&amp;refer=http%3A%2F%2Fimg2020.cnblogs.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1631850161&amp;t=6d469dd55c5fe126c015c961c1566509" srcset="/img/loading.gif" lazyload alt=""></p><h2 id="17-promiseçš„api"><a class="markdownIt-Anchor" href="#17-promiseçš„api"></a> 1.7 Promiseçš„API</h2><h3 id="171-promiseæ„é€ å‡½æ•°"><a class="markdownIt-Anchor" href="#171-promiseæ„é€ å‡½æ•°"></a> 1.7.1 Promiseæ„é€ å‡½æ•°</h3><p>Promiseçš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-title">Promise</span>(<span class="hljs-params">excutor</span>)</span> &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>excutor</code>æ˜¯ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(resolve, reject) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>resolve</code>å’Œ<code>reject</code>ä¹Ÿä¸ºå‡½æ•°å‚æ•°ï¼š</p><ul><li><code>resolve</code>æ–¹æ³•ï¼šå†…éƒ¨å®šä¹‰æˆåŠŸæ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°<code>value =&gt; &#123;&#125;</code></li><li><code>reject</code>æ–¹æ³•ï¼šå†…éƒ¨å®šä¹‰å¤±è´¥æ—¶æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°<code>reason =&gt; &#123;&#125;</code></li></ul><blockquote><p>æ³¨æ„ï¼š<code>excutor</code>ä¼šåœ¨Promiseå†…éƒ¨ç«‹å³åŒæ­¥è°ƒç”¨ï¼Œå¼‚æ­¥æ“ä½œåœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œã€‚</p></blockquote><h3 id="172-promiseprototypethenæ–¹æ³•"><a class="markdownIt-Anchor" href="#172-promiseprototypethenæ–¹æ³•"></a> 1.7.2 <code>Promise.prototype.then</code>æ–¹æ³•</h3><p><code>Promise.prototype.then</code>æ–¹æ³•å¦‚ä¸‹ï¼Œthenæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(onResolved, onRejected) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>onResolved</code>å’Œ<code>onRejected</code>ä¸ºå‡½æ•°å‚æ•°ï¼š</p><ul><li><code>onResolved</code>å‡½æ•°ï¼šæˆåŠŸçš„å›è°ƒå‡½æ•°<code>(value) =&gt; &#123;&#125;</code></li><li><code>onRejected</code>å‡½æ•°ï¼šå¤±è´¥çš„å›è°ƒå‡½æ•°<code>(reason) =&gt; &#123;&#125;</code></li></ul><h3 id="173-promiseprototypecatchæ–¹æ³•"><a class="markdownIt-Anchor" href="#173-promiseprototypecatchæ–¹æ³•"></a> 1.7.3 <code>Promise.prototype.catch</code>æ–¹æ³•</h3><p><code>Promise.prototype.catch</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(onRejected) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>onRejected</code>ä¸ºå‡½æ•°å‚æ•°ï¼š</p><ul><li><code>onRejected</code>å‡½æ•°ï¼šå¤±è´¥çš„å›è°ƒå‡½æ•°<code>(reason) =&gt; &#123;&#125;</code></li></ul><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•å’Œ<code>then</code>æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯åªèƒ½è°ƒç”¨å¤±è´¥çš„å›è°ƒç»“æœã€‚</p></blockquote><h3 id="174-promiseresolveæ–¹æ³•"><a class="markdownIt-Anchor" href="#174-promiseresolveæ–¹æ³•"></a> 1.7.4 <code>Promise.resolve</code>æ–¹æ³•</h3><p><code>Promise.resolve</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(value) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>value</code>ä¸ºæˆåŠŸçš„æ•°æ®æˆ–Promiseå¯¹è±¡ï¼Œ<code>resolve</code>æ–¹æ³•çš„ç»“æœè¦çœ‹ä¼ å…¥çš„å‚æ•°ã€‚</p><ul><li>å¦‚æœä¼ å…¥çš„æ˜¯éPromiseç±»å‹çš„å¯¹è±¡ï¼Œåˆ™è¿”å›çš„ç»“æœä¸ºæˆåŠŸPromiseå¯¹è±¡</li><li>å¦‚æœä¼ å…¥çš„æ˜¯Promiseç±»å‹çš„å¯¹è±¡ï¼Œåˆ™è¯¥Promiseçš„ç»“æœå†³å®šç€resolveçš„ç»“æœã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-comment">// å¦‚æœä¼ å…¥çš„æ˜¯éPromiseç±»å‹çš„å¯¹è±¡ï¼Œåˆ™è¿”å›çš„ç»“æœä¸ºæˆåŠŸPromiseå¯¹è±¡ã€‚</span><br><span class="hljs-keyword">let</span> p1 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">123</span>)<br><span class="hljs-comment">// å¦‚æœä¼ å…¥çš„æ˜¯Promiseç±»å‹çš„å¯¹è±¡ï¼Œåˆ™è¯¥Promiseçš„ç»“æœå†³å®šç€resolveçš„ç»“æœã€‚</span><br><span class="hljs-keyword">let</span> p2 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>) <span class="hljs-comment">// æˆåŠŸ</span><br>  <span class="hljs-comment">// reject(&#x27;err&#x27;) // å¤±è´¥</span><br>&#125;))<br><br><span class="hljs-built_in">console</span>.log(p1) <span class="hljs-comment">// &lt;fulfilled&gt;: 123</span><br><span class="hljs-built_in">console</span>.log(p2) <span class="hljs-comment">// &lt;fulfilled&gt;: &quot;ok&quot;</span><br></code></pre></div></td></tr></table></figure><h3 id="175-promiserejectæ–¹æ³•"><a class="markdownIt-Anchor" href="#175-promiserejectæ–¹æ³•"></a> 1.7.5 <code>Promise.reject</code>æ–¹æ³•</h3><p><code>Promise.reject</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(reason) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>reason</code>ä¸ºå¤±è´¥çš„åŸå› ï¼Œå®ƒçš„ç»“æœæ°¸è¿œæ˜¯å¤±è´¥çš„å¹¶ä¸”è¿”å›ä»€ä¹ˆï¼Œå¤±è´¥çš„ç»“æœå°±æ˜¯ä»€ä¹ˆã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p3 = <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-number">123</span>)<br><span class="hljs-keyword">let</span> p4 = <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>) <span class="hljs-comment">// å³ä½¿è¿™é‡Œä¼ å…¥resolveï¼Œç»“æœä¹Ÿæ˜¯å¤±è´¥çš„rejected</span><br>&#125;))<br><span class="hljs-built_in">console</span>.log(p3) <span class="hljs-comment">// rejected</span><br><span class="hljs-built_in">console</span>.log(p4) <span class="hljs-comment">// rejected</span><br></code></pre></div></td></tr></table></figure><h3 id="176-promiseallæ–¹æ³•"><a class="markdownIt-Anchor" href="#176-promiseallæ–¹æ³•"></a> 1.7.6 <code>Promise.all</code>æ–¹æ³•</h3><p><code>Promise.all</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(promises) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>promises</code>æ˜¯åŒ…å«nä¸ªPromiseçš„æ•°ç»„ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œåªæœ‰æ‰€æœ‰çš„Promiseéƒ½æˆåŠŸæ‰ç®—æˆåŠŸï¼Œåªè¦æœ‰ä¸€ä¸ªPromiseå¤±è´¥å°±ç›´æ¥å¤±è´¥äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br><span class="hljs-keyword">let</span> p2 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">&#x27;good&#x27;</span>)<br><span class="hljs-keyword">let</span> p3 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-string">&#x27;fine&#x27;</span>)<br><span class="hljs-keyword">const</span> result = <span class="hljs-built_in">Promise</span>.all([p1, p2, p3])<br><span class="hljs-built_in">console</span>.log(result) <span class="hljs-comment">// fulfilled</span><br></code></pre></div></td></tr></table></figure><h3 id="177-promiseraceæ–¹æ³•"><a class="markdownIt-Anchor" href="#177-promiseraceæ–¹æ³•"></a> 1.7.7 <code>Promise.race</code>æ–¹æ³•</h3><p><code>Promise.race</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript">(promises) =&gt; &#123;<br>	<span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­<code>promises</code>æ˜¯åŒ…å«nä¸ªPromiseçš„æ•°ç»„ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œç¬¬ä¸€ä¸ªå®Œæˆçš„Promiseçš„ç»“æœçŠ¶æ€å°±æ˜¯æœ€ç»ˆçš„ç»“æœçŠ¶æ€ã€‚</p><h2 id="18-promiseçš„å‡ ä¸ªå…³é”®é—®é¢˜"><a class="markdownIt-Anchor" href="#18-promiseçš„å‡ ä¸ªå…³é”®é—®é¢˜"></a> 1.8 Promiseçš„å‡ ä¸ªå…³é”®é—®é¢˜</h2><h3 id="181-å¦‚ä½•æ”¹å˜promiseçŠ¶æ€"><a class="markdownIt-Anchor" href="#181-å¦‚ä½•æ”¹å˜promiseçŠ¶æ€"></a> 1.8.1 å¦‚ä½•æ”¹å˜PromiseçŠ¶æ€</h3><p>Promiseåœ¨æ²¡æœ‰æ”¹å˜çŠ¶æ€å‰å¤„äºpendingçŠ¶æ€ï¼ŒçŠ¶æ€çš„æ”¹å˜åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ol><li><code>resolve(value)</code>ï¼šå¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºresolved</li><li><code>reject(reason)</code>ï¼šå¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºrejected</li><li>æŠ›å‡ºå¼‚å¸¸ï¼šå¦‚æœå½“å‰æ˜¯pendingå°±ä¼šå˜ä¸ºrejected</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// resolveå‡½æ•°ï¼špending -&gt; fulfilled</span><br>  <span class="hljs-comment">// resolve(&#x27;ok&#x27;)</span><br>  <span class="hljs-comment">// // rejectå‡½æ•°ï¼špending -&gt; rejected</span><br>  <span class="hljs-comment">// reject(&#x27;err&#x27;)</span><br>  <span class="hljs-comment">// æŠ›å‡ºé”™è¯¯ï¼špending -&gt; rejected</span><br>  <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;fatal err&#x27;</span><br>&#125;)<br><span class="hljs-built_in">console</span>.log(p) <span class="hljs-comment">// rejected</span><br></code></pre></div></td></tr></table></figure><h3 id="182-æ˜¯å¦ä¼šè°ƒç”¨promiseæŒ‡å®šçš„æ‰€æœ‰å›è°ƒå‡½æ•°"><a class="markdownIt-Anchor" href="#182-æ˜¯å¦ä¼šè°ƒç”¨promiseæŒ‡å®šçš„æ‰€æœ‰å›è°ƒå‡½æ•°"></a> 1.8.2 æ˜¯å¦ä¼šè°ƒç”¨PromiseæŒ‡å®šçš„æ‰€æœ‰å›è°ƒå‡½æ•°</h3><p>å½“Promiseæ”¹å˜ä¸ºå¯¹åº”çŠ¶æ€æ—¶éƒ½ä¼šè°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œä¸‹é¢çš„ç¨‹åºç»™Promiseå®ä¾‹æŒ‡å®šäº†ä¸¤ä¸ªæˆåŠŸçš„å›è°ƒï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå›è°ƒå‡½æ•°éƒ½è¢«æ‰§è¡Œäº†ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;first &#x27;</span> + value)<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;second &#x27;</span> + value)<br>&#125;)<br><span class="hljs-comment">// first ok</span><br><span class="hljs-comment">// second ok</span><br></code></pre></div></td></tr></table></figure><h3 id="183-æ”¹å˜promiseçŠ¶æ€å’ŒæŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œè°å…ˆè°åresolverejectå’Œthenæ‰§è¡Œçš„å…ˆå"><a class="markdownIt-Anchor" href="#183-æ”¹å˜promiseçŠ¶æ€å’ŒæŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œè°å…ˆè°åresolverejectå’Œthenæ‰§è¡Œçš„å…ˆå"></a> 1.8.3 æ”¹å˜PromiseçŠ¶æ€å’ŒæŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œè°å…ˆè°åï¼ˆresolve/rejectå’Œthenæ‰§è¡Œçš„å…ˆåï¼‰ï¼Ÿ</h3><p>ä¸¤ç§å…ˆåå…³ç³»éƒ½æœ‰å¯èƒ½ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯å…ˆæŒ‡å®šå›è°ƒå†æ”¹å˜çŠ¶æ€ï¼Œä½†ä¹Ÿå¯ä»¥å…ˆæ”¹å˜çŠ¶æ€å†æŒ‡å®šå›è°ƒã€‚ä¸‹é¢æ˜¯å…ˆæ”¹å˜çŠ¶æ€å†æŒ‡å®šå›è°ƒçš„æ–¹æ³•ï¼š</p><ol><li>åœ¨æ‰§è¡Œå™¨ä¸­ç›´æ¥è°ƒç”¨<code>resolve()/reject()</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>) <span class="hljs-comment">// ç›´æ¥è°ƒç”¨</span><br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value)<br>&#125;)<br></code></pre></div></td></tr></table></figure><ol start="2"><li>å»¶è¿Ÿæ›´é•¿æ—¶é—´æ‰è°ƒç”¨<code>then()</code>ï¼Œå³é€šè¿‡å»¶è¿Ÿä¿è¯<code>then()</code>æ–¹æ³•çš„è°ƒç”¨åœ¨å…¶ä¹‹åã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// ä½¿ç”¨å®šæ—¶å™¨</span><br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value)<br>&#125;)<br></code></pre></div></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸Šé¢è¿™ç§æƒ…å†µå°±æ˜¯å…ˆæŒ‡å®šæˆåŠŸå›è°ƒï¼Œå†æ”¹å˜Promiseçš„çŠ¶æ€resolveã€‚è¿™ç§æƒ…å†µåœ¨æ—¥å¸¸å¼€å‘æ˜¯æœ€å¸¸è§çš„ï¼Œå› ä¸ºæ—¥å¸¸å¼€å‘ä¸­å¾ˆå¤šéƒ½æ˜¯è¯»å†™æ–‡ä»¶æˆ–è€…ç½‘ç»œè¯·æ±‚ï¼Œéƒ½æ˜¯å±äºå¼‚æ­¥ä»»åŠ¡ã€‚æŒ‡å®šå’Œæ‰§è¡Œä¸æ˜¯åŒä¸€ä¸ªæ„æ€ã€‚æ€»ç»“æ¥è®²ï¼špromiseå¯¹è±¡æ˜¯åŒæ­¥æ—¶ï¼Œæ‰§è¡Œé‡Œé¢çš„resolveæˆ–rejectç„¶åç»§ç»­æ‰§è¡ŒthenåŠå›è°ƒï¼Œå¦‚æœæ˜¯å¼‚æ­¥ï¼Œåˆ™å…ˆæ‰§è¡Œthenï¼Œå¼‚æ­¥æ‰§è¡Œå®Œäº†ï¼Œæ”¹å˜äº†çŠ¶æ€å†æ‰§è¡Œthené‡Œçš„å›è°ƒã€‚</p></blockquote><h3 id="184-ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®å³å›è°ƒå‡½æ•°åˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ"><a class="markdownIt-Anchor" href="#184-ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®å³å›è°ƒå‡½æ•°åˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ"></a> 1.8.4 ä»€ä¹ˆæ—¶å€™æ‰èƒ½å¾—åˆ°æ•°æ®ï¼ˆå³å›è°ƒå‡½æ•°åˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼‰</h3><ol><li>å¦‚æœå…ˆæŒ‡å®šçš„å›è°ƒï¼Œé‚£å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®</li><li>å¦‚æœå…ˆæ”¹å˜çš„çŠ¶æ€ï¼Œé‚£å½“æŒ‡å®šå›è°ƒæ—¶ï¼Œå›è°ƒå‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œå¾—åˆ°æ•°æ®</li></ol><p>æ€»ç»“æ¥è¯´ï¼š<code>then()</code>æ–¹æ³•éƒ½éœ€è¦<code>resolve()</code> / <code>reject()</code>å»è§¦å‘ã€‚</p><h3 id="185-promisethenè¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š"><a class="markdownIt-Anchor" href="#185-promisethenè¿”å›çš„æ–°promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š"></a> 1.8.5 <code>Promise.then()</code>è¿”å›çš„æ–°Promiseçš„ç»“æœçŠ¶æ€ç”±ä»€ä¹ˆå†³å®š</h3><p>ç®€å•æ¥è¯´æ˜¯ç”±<code>then()</code>æŒ‡å®šçš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ç»“æœå†³å®šï¼Œä½†æ˜¯åˆ†ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li>å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæ–°Promiseå˜ä¸ºrejectedï¼Œreasonä¸ºæŠ›å‡ºçš„å¼‚å¸¸</li><li>å¦‚æœè¿”å›çš„æ˜¯éPromiseçš„ä»»æ„å€¼ï¼Œæ–°Promiseå˜ä¸ºresolvedï¼Œvalueä¸ºè¿”å›å€¼</li><li>å¦‚æœè¿”å›çš„æ˜¯å¦ä¸€ä¸ªæ–°çš„Promiseï¼Œæ­¤Promiseçš„ç»“æœå°±ä¼šæˆä¸ºæ–°çš„Promiseçš„ç»“æœ</li></ol><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>&#125;)<br><span class="hljs-keyword">let</span> result = p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// 1.æŠ›å‡ºå¼‚å¸¸</span><br>  <span class="hljs-comment">// throw &#x27;error&#x27;</span><br>  <span class="hljs-comment">// 2.è¿”å›éPromiseç±»å‹çš„å¯¹è±¡</span><br>  <span class="hljs-comment">// return 123</span><br>  <span class="hljs-comment">// 3.è¿”å›Promiseå¯¹è±¡</span><br>  <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;)<br>&#125;, <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason)<br>&#125;)<br><span class="hljs-built_in">console</span>.log(result) <span class="hljs-comment">// fulfilled ok</span><br></code></pre></div></td></tr></table></figure><h3 id="186-promiseå¦‚ä½•ä¸²è¿å¤šä¸ªæ“ä½œä»»åŠ¡"><a class="markdownIt-Anchor" href="#186-promiseå¦‚ä½•ä¸²è¿å¤šä¸ªæ“ä½œä»»åŠ¡"></a> 1.8.6 Promiseå¦‚ä½•ä¸²è¿å¤šä¸ªæ“ä½œä»»åŠ¡</h3><p>Promiseçš„<code>then()</code>è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå¯ä»¥å½¢æˆ<code>then()</code>çš„é“¾å¼è°ƒç”¨ï¼Œé€šè¿‡<code>then()</code>çš„é“¾å¼è°ƒç”¨ä¸²è¿å¤šä¸ªåŒæ­¥/å¼‚æ­¥ä»»åŠ¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå½¢æˆåç»­çš„thené“¾å¼è°ƒç”¨</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(value) <span class="hljs-comment">// ok</span><br>&#125;)<br></code></pre></div></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè‹¥ä¸è¿”å›Promiseï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨ï¼Œä¸è¿‡ä¸‹ä¸€æ¬¡è°ƒç”¨æ— æ³•è·å–å‰ä¸€æ¬¡è°ƒç”¨çš„ç»“æœå€¼ï¼Œå¦‚ä¸Šé¢çš„ä»£ç ï¼Œvalueçš„å€¼ä¸ºè¿”å›çš„Promiseå¯¹è±¡çš„ç»“æœï¼Œæ˜¯å¯ä»¥å–åˆ°çš„ï¼Œè€Œä¸‹é¢1.8.7èŠ‚ä¸­çš„ä»£ç ï¼Œå…¶ä¸­çš„æ‰€æœ‰valueå€¼éƒ½æ˜¯undefinedã€‚</p></blockquote><h3 id="187-promiseå¼‚å¸¸ç©¿é€"><a class="markdownIt-Anchor" href="#187-promiseå¼‚å¸¸ç©¿é€"></a> 1.8.7 Promiseå¼‚å¸¸ç©¿é€</h3><p>å½“ä½¿ç”¨Promiseçš„<code>then()</code>é“¾å¼è°ƒç”¨æ—¶ï¼Œå¯ä»¥åœ¨æœ€åæŒ‡å®šå¤±è´¥çš„å›è°ƒï¼Œå³å‰é¢ä»»ä½•æ“ä½œå‡ºäº†å¼‚å¸¸ï¼Œéƒ½ä¼šä¼ åˆ°æœ€åå¤±è´¥çš„å›è°ƒä¸­å¤„ç†ï¼Œä¸‹é¢ä»£ç åªä¼šè¾“å…¥â€œerrâ€ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    reject(<span class="hljs-string">&#x27;err&#x27;</span>)<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>)<br>&#125;).catch(<span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason) <span class="hljs-comment">// err</span><br>&#125;)<br></code></pre></div></td></tr></table></figure><p>æ­¤å¤–ï¼Œæœ€åçš„<code>catch</code>æ–¹æ³•èƒ½å¤Ÿæ•æ‰åˆ°<code>then()</code>è°ƒç”¨é“¾ä¸Šçš„ä»»ä½•é”™è¯¯ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;error&#x27;</span><br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>)<br>&#125;).catch(<span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason) <span class="hljs-comment">// error</span><br>&#125;)<br></code></pre></div></td></tr></table></figure><h3 id="188-å¦‚ä½•ä¸­æ–­promiseé“¾"><a class="markdownIt-Anchor" href="#188-å¦‚ä½•ä¸­æ–­promiseé“¾"></a> 1.8.8 å¦‚ä½•ä¸­æ–­Promiseé“¾</h3><p>è§£å†³åŠæ³•æ˜¯åœ¨å›è°ƒå‡½æ•°ä¸­è¿”å›ä¸€ä¸ªpendingçŠ¶æ€çš„Promiseå¯¹è±¡ã€‚åœ¨è°ƒç”¨é“¾ä¸­é—´ä½¿ç”¨returnæˆ–æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™éƒ½æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œæœ‰ä¸”åªæœ‰ä¸€ç§æ–¹å¼ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªpendingçŠ¶æ€çš„Promiseå¯¹è±¡ã€‚å³thenæ–¹æ³•ä¹Ÿæ˜¯è¿”å›çš„pendingçŠ¶æ€çš„Promiseå¯¹è±¡ï¼Œåç»­çš„thenå›è°ƒéƒ½ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºçŠ¶æ€æ²¡æœ‰æ”¹å˜ï¼Œåç»­çš„thenå°±ä¸ä¼šæ‰§è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    resolve(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>  &#125;, <span class="hljs-number">1000</span>);<br>&#125;)<br>p.then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)<br>  <span class="hljs-comment">// ä¸­æ–­Promiseè°ƒç”¨é“¾</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)<br>&#125;).then(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>)<br>&#125;).catch(<span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(reason)<br>&#125;)<br></code></pre></div></td></tr></table></figure></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/2021/08/20/Promise%E8%87%AA%E5%AE%9A%E4%B9%89/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Promiseè‡ªå®šä¹‰</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/2021/08/14/npm%E9%95%9C%E5%83%8F%E6%BA%90%E6%9F%A5%E7%9C%8B%E5%92%8C%E5%88%87%E6%8D%A2/"><span class="hidden-mobile">npmé•œåƒæºæŸ¥çœ‹å’Œåˆ‡æ¢</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>$("#local-search-input").on("click",(function(){searchFunc("/local-search.xml","local-search-input","local-search-result")})),$("#modalSearch").on("shown.bs.modal",(function(){$("#local-search-input").focus()}))</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css"><script src="/js/boot.js"></script></body></html>